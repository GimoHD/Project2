changed some functions to protected